#ifndef __CLING__
#include <iostream>
#include <map>
#include <string>
#include <vector>

#include "TCutG.h"
#include "kobra.hxx"
#endif

void ppac_eff2() {
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // cuts
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // for 550 V
    //
    // oxygen
    std::vector<Double_t> cutg_vect0{246.5817015020681, 244.4716407008756, 243.2900066522078, 243.7120188124463,
                                     244.0496285406371, 245.5688723174957, 248.6073598712129, 249.1137744634991,
                                     248.3541525750698, 246.5817015020681};
    std::vector<Double_t> cutg_vect1{24.00844420221545, 23.30475944249739, 20.49002040362513, 18.50690880805604,
                                     16.97159660503481, 16.97159660503481, 17.93116673192308, 20.74590577079534,
                                     23.43270212608249, 24.00844420221545};
    TCutG *cutg_550_o = new TCutG("o_550", 10, cutg_vect0.data(), cutg_vect1.data());
    cutg_550_o->SetVarX("tof");
    cutg_550_o->SetVarY("de");
    cutg_550_o->SetTitle("O_550");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // fluorine
    std::vector<Double_t> cutg_vect2{241.0955434189675, 239.6607020741566, 239.0698850498227, 239.9983118023474,
                                     241.4331531471584, 242.6991896278739, 243.7120188124463, 245.4000674534003,
                                     245.2312625893049, 244.3028358367802, 242.1927750355877, 241.0955434189675};
    std::vector<Double_t> cutg_vect3{29.31806557099721, 25.73567043061434, 22.15327529023146, 20.74590577079534,
                                     20.29810637824747, 20.29810637824747, 21.4495905305134,  25.67169908882179,
                                     27.71878202618343, 30.40557838147058, 30.46954972326314, 29.31806557099721};
    TCutG *cutg_550_f = new TCutG("f_550", 12, cutg_vect2.data(), cutg_vect3.data());
    cutg_550_f->SetVarX("tof");
    cutg_550_f->SetVarY("de");
    cutg_550_f->SetTitle("F_550");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // neon
    std::vector<Double_t> cutg_vect4{239.0698850498227, 237.5506412729641, 236.7066169524871, 237.1286291127256,
                                     239.1542874818704, 239.9983118023474, 241.1799458510152, 241.2643482830629,
                                     240.673531258729,  239.6607020741566, 239.0698850498227};
    std::vector<Double_t> cutg_vect5{35.58725706666724, 34.62768693977897, 31.42911985015141, 26.5672978739175,
                                     26.4393551903324,  26.95112592467281, 30.14969301430038, 35.71519975025235,
                                     36.4188845099704,  36.4188845099704,  35.58725706666724};
    TCutG *cutg_550_ne = new TCutG("ne_550", 11, cutg_vect4.data(), cutg_vect5.data());
    cutg_550_ne->SetVarX("tof");
    cutg_550_ne->SetVarY("de");
    cutg_550_ne->SetTitle("Ne_550");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // sodium
    std::vector<Double_t> cutg_vect6{235.4405804717716, 234.0901415590083, 234.5965561512945,
                                     235.8625926320101, 237.6350437050118, 238.7322753216319,
                                     238.3946655934411, 236.453409656344,  235.4405804717716};
    std::vector<Double_t> cutg_vect7{41.53659185337451, 37.69831134582143, 34.81960096515662,
                                     34.30783023081622, 36.35491316817786, 39.29759489063522,
                                     41.98439124592237, 42.49616198026278, 41.53659185337451};
    TCutG *cutg_550_na = new TCutG("na_550", 9, cutg_vect6.data(), cutg_vect7.data());
    cutg_550_na->SetVarX("tof");
    cutg_550_na->SetVarY("de");
    cutg_550_na->SetTitle("Na_550");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // for 575 V
    //
    // oxygen
    std::vector<Double_t> cutg_vect8{239.0671640161925, 238.1716416147885, 237.7985072808702, 238.2462684815722,
                                     239.7388058172455, 242.2014924211066, 243.917910357131,  243.1716416892943,
                                     240.8582088190006, 239.0671640161925};
    std::vector<Double_t> cutg_vect9{22.62391719269755, 20.75914334392854, 18.71390750979479, 16.42805569517471,
                                     16.1272857195668,  16.66867167566103, 20.09744939759115, 22.80437917806229,
                                     23.46607312439968, 22.62391719269755};
    TCutG *cutg_575_o = new TCutG("o_575", 10, cutg_vect8.data(), cutg_vect9.data());
    cutg_575_o->SetVarX("tof");
    cutg_575_o->SetVarY("de");
    cutg_575_o->SetTitle("O_575");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // fluorine
    std::vector<Double_t> cutg_vect10{235.5597012773601, 234.440298275605,  234.0671639416867, 234.440298275605,
                                      236.4552236787641, 237.8731341476538, 238.9179102826252, 238.9179102826252,
                                      237.3507460801681, 236.0074624780621, 235.5597012773601};
    std::vector<Double_t> cutg_vect11{28.03777675363984, 26.23315689999241, 22.20283922684648, 20.63883535368538,
                                      19.85683341710482, 20.93960532929328, 23.16530314879178, 27.25577481705929,
                                      28.57916270973407, 28.33854672924774, 28.03777675363984};
    TCutG *cutg_575_f = new TCutG("f_575", 11, cutg_vect10.data(), cutg_vect11.data());
    cutg_575_f->SetVarX("tof");
    cutg_575_f->SetVarY("de");
    cutg_575_f->SetTitle("F_575");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // neon
    std::vector<Double_t> cutg_vect12{232.2761191388786, 230.9328355367726, 230.9328355367726, 231.4552236042583,
                                      232.873134073148,  233.992537074903,  235.0373132098744, 235.7089550109274,
                                      235.4104475437927, 234.216417675254,  232.2761191388786};
    std::vector<Double_t> cutg_vect13{33.69225229506845, 31.6470164609347,  28.75962469509881, 27.31592881218087,
                                      26.41361888535715, 26.35346489023557, 28.57916270973407, 31.22593849508363,
                                      34.1734842560411,  34.65471621701374, 33.69225229506845};
    TCutG *cutg_575_ne = new TCutG("ne_575", 11, cutg_vect12.data(), cutg_vect13.data());
    cutg_575_ne->SetVarX("tof");
    cutg_575_ne->SetVarY("de");
    cutg_575_ne->SetTitle("Ne_575");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // sodium
    std::vector<Double_t> cutg_vect14{229.2164176007482, 228.7686564000462, 230.1119400021523,
                                      231.3805967374746, 233.1716415402827, 233.3955221406337,
                                      232.5746266060133, 230.6343280696379, 229.2164176007482};
    std::vector<Double_t> cutg_vect15{39.82795979746971, 35.67733413408062, 33.99302227067636,
                                      34.29379224628426, 36.39918207553959, 40.30919175844236,
                                      41.69273364623872, 42.11381161208978, 39.82795979746971};
    TCutG *cutg_575_na = new TCutG("na_575", 9, cutg_vect14.data(), cutg_vect15.data());
    cutg_575_na->SetVarX("tof");
    cutg_575_na->SetVarY("de");
    cutg_575_na->SetTitle("Na_575");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // for 585 V
    //
    // nitrogen
    std::vector<Double_t> cutg_vect16{239.762631718634,  236.9863962525008, 236.3617432726209,
                                      236.9863962525008, 241.6365906582739, 244.2740143511004,
                                      244.0657966911404, 240.8731259050872, 239.762631718634};
    std::vector<Double_t> cutg_vect17{17.24537025481737, 16.72453691372302, 14.98842577674184,
                                      12.44212944250277, 12.26851832880465, 14.98842577674184,
                                      16.60879617125761, 17.88194433837714, 17.24537025481737};
    TCutG *cutg_585_n = new TCutG("n_585", 9, cutg_vect16.data(), cutg_vect17.data());
    cutg_585_n->SetVarX("tof");
    cutg_585_n->SetVarY("de");
    cutg_585_n->SetTitle("N_585");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // oxygen
    std::vector<Double_t> cutg_vect18{234.8348137662476, 232.4750136200345, 232.0585783001145, 231.1563017736212,
                                      234.3489725596743, 236.5005550459275, 239.762631718634,  239.0685728521007,
                                      236.6393668192342, 234.8348137662476};
    std::vector<Double_t> cutg_vect19{21.12268512740869, 20.65972215754704, 19.73379621782374, 17.12962951235196,
                                      15.50925911783619, 16.66666654249032, 19.3865739904275,  20.83333327124516,
                                      21.41203698357222, 21.12268512740869};
    TCutG *cutg_585_o = new TCutG("o_585", 10, cutg_vect18.data(), cutg_vect19.data());
    cutg_585_o->SetVarX("tof");
    cutg_585_o->SetVarY("de");
    cutg_585_o->SetTitle("O_585");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // fluorine
    std::vector<Double_t> cutg_vect20{230.6010546803946, 227.8248192142614, 227.6860074409548, 228.0330368742214,
                                      229.4905604939413, 232.5444195066878, 234.487784332981,  234.6265961062876,
                                      233.7937254664477, 232.5444195066878, 230.6010546803946};
    std::vector<Double_t> cutg_vect21{26.50462965205036, 25.52083334109435, 22.85879626438987, 21.00694438494327,
                                      20.71759252877974, 21.2384258698741,  22.62731477945905, 25.28935185616353,
                                      26.79398150821389, 26.9097222506793,  26.50462965205036};
    TCutG *cutg_585_f = new TCutG("f_585", 11, cutg_vect20.data(), cutg_vect21.data());
    cutg_585_f->SetVarX("tof");
    cutg_585_f->SetVarY("de");
    cutg_585_f->SetTitle("F_585");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // neon
    std::vector<Double_t> cutg_vect22{227.5471956676481, 225.3262072947416, 224.9097719748216, 227.1307603477281,
                                      230.045807587168,  230.7398664537012, 231.2951135469279, 231.2951135469279,
                                      229.212936947328,  227.5471956676481};
    std::vector<Double_t> cutg_vect23{32.63888900271721, 30.96064823696873, 26.79398150821389, 25.69444445479247,
                                      26.8518518794466,  27.66203707670448, 30.72916675203791, 33.56481494244051,
                                      34.14351865476757, 32.63888900271721};
    TCutG *cutg_585_ne = new TCutG("ne_585", 10, cutg_vect22.data(), cutg_vect23.data());
    cutg_585_ne->SetVarX("tof");
    cutg_585_ne->SetVarY("de");
    cutg_585_ne->SetTitle("Ne_585");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // sodium
    std::vector<Double_t> cutg_vect24{225.3262072947416, 222.7581894885684, 222.9664071485284,
                                      225.5344249547016, 227.6860074409548, 229.3517487206347,
                                      229.212936947328,  227.1307603477281, 225.3262072947416};
    std::vector<Double_t> cutg_vect25{39.23611132324571, 37.67361129996264, 33.96990754106945,
                                      33.27546308627698, 34.49074088216381, 36.80555573147205,
                                      40.33564837666712, 40.56712986159795, 39.23611132324571};
    TCutG *cutg_585_na = new TCutG("na_585", 9, cutg_vect24.data(), cutg_vect25.data());
    cutg_585_na->SetVarX("tof");
    cutg_585_na->SetVarY("de");
    cutg_585_na->SetTitle("Na_585");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // for 595 V
    //
    // carbon
    std::vector<Double_t> cutg_vect26{226.2357410907518, 224.7306713598328, 229.8795941235032, 235.4245878689945,
                                      232.5728767998847, 228.0576676071275, 226.2357410907518};
    std::vector<Double_t> cutg_vect27{11.78007115876713, 9.67762464425781,  9.167940640740397, 11.27038715524972,
                                      12.35346566272422, 12.54459716404325, 11.78007115876713};
    TCutG *cutg_595_c = new TCutG("c_595", 7, cutg_vect26.data(), cutg_vect27.data());
    cutg_595_c->SetVarX("tof");
    cutg_595_c->SetVarY("de");
    cutg_595_c->SetTitle("C_595");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // nitrogen
    std::vector<Double_t> cutg_vect28{223.5424584143704, 220.1362479707115, 218.9480350252491, 219.5817485961624,
                                      222.5918880580005, 228.29531019622,   229.5627373380466, 228.9290237671333,
                                      226.2357410907518, 223.5424584143704};
    std::vector<Double_t> cutg_vect29{15.6664116855874,  15.41156968382869, 13.81880717283678, 12.73572866536228,
                                      12.35346566272422, 12.99057066712099, 13.94622817371613, 15.15672768206999,
                                      15.79383268646675, 15.6664116855874};
    TCutG *cutg_595_n = new TCutG("n_595", 10, cutg_vect28.data(), cutg_vect29.data());
    cutg_595_n->SetVarX("tof");
    cutg_595_n->SetVarY("de");
    cutg_595_n->SetTitle("N_595");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // oxygen
    std::vector<Double_t> cutg_vect30{223.7801010034629, 217.5221794906942, 216.1755381525035, 217.5221794906942,
                                      222.354245468908,  231.226235461694,  234.8700884944454, 234.3155891198962,
                                      231.8599490326072, 226.314955287116,  223.7801010034629};
    std::vector<Double_t> cutg_vect31{19.80759421416637, 19.04306820889025, 17.64143719921737, 16.11238518866513,
                                      16.49464819130319, 16.94062169438093, 18.21483170317446, 19.87130471460605,
                                      20.31727821768378, 20.06243621592508, 19.80759421416637};
    TCutG *cutg_595_o = new TCutG("o_595", 11, cutg_vect30.data(), cutg_vect31.data());
    cutg_595_o->SetVarX("tof");
    cutg_595_o->SetVarY("de");
    cutg_595_o->SetTitle("O_595");
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // fluorine
    std::vector<Double_t> cutg_vect32{222.9087448434571, 218.3935356507,    219.4233202034341, 221.2452467198097,
                                      229.6419515344108, 231.1470212653298, 231.5430922471506, 231.226235461694,
                                      228.6121669816767, 224.7306713598328, 222.9087448434571};
    std::vector<Double_t> cutg_vect33{24.13990824406437, 22.80198773483117, 20.89067272164087, 20.31727821768378,
                                      20.38098871812346, 21.20922522383925, 22.99311923615019, 24.58588174714211,
                                      25.22298675153887, 24.58588174714211, 24.13990824406437};
    TCutG *cutg_595_f = new TCutG("f_595", 11, cutg_vect32.data(), cutg_vect33.data());
    cutg_595_f->SetVarX("tof");
    cutg_595_f->SetVarY("de");
    cutg_595_f->SetTitle("F_595");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // neon
    std::vector<Double_t> cutg_vect34{223.7008868070987, 219.1064634179774, 221.4036751125381, 224.809885556197,
                                      229.0082379634975, 229.1666663562258, 226.8694546616651, 223.7008868070987};
    std::vector<Double_t> cutg_vect35{28.21738027220367, 26.68832826165143, 25.35040775241822, 24.96814474978017,
                                      25.73267075505628, 27.07059126428949, 28.40851177352269, 28.21738027220367};
    TCutG *cutg_595_ne = new TCutG("ne_595", 8, cutg_vect34.data(), cutg_vect35.data());
    cutg_595_ne->SetVarX("tof");
    cutg_595_ne->SetVarY("de");
    cutg_595_ne->SetTitle("Ne_595");
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    std::vector<Int_t> hvs = {595, 585, 575, 550};
    std::map<Int_t, std::vector<Int_t>> runNs = {
        {595, {601, 602, 603, 604}}, {585, {610, 611, 612}}, {575, {615, 616, 617}}, {550, {620, 621, 622, 623, 625}}};
    std::map<Int_t, Double_t> brhos = {{595, 1.373244}, {585, 1.310745}, {575, 1.282418}, {550, 1.251361}};
    std::map<Int_t, std::vector<std::string>> cuts = {{595, {"c_595", "n_595", "o_595", "f_595", "ne_595"}},
                                                      {585, {"n_585", "o_585", "f_585", "ne_585", "na_585"}},
                                                      {575, {"o_575", "f_575", "ne_575", "na_575"}},
                                                      {550, {"o_550", "f_550", "ne_550", "na_550"}}};

    std::map<std::string, std::map<Int_t, Double_t>> f1Eff;
    KOBRA *ko;
    for (const auto &hv : hvs) {
        ko = new KOBRA(KOBRA::Expt::Phys, runNs[hv], brhos[hv]);
        std::vector<std::string> cut_names = cuts[hv];
        for (auto cut_name : cut_names) {
            // cut_name에서 앞에 원소기호만 잘라내기
            std::string elem = cut_name.substr(0, cut_name.find('_'));
            f1Eff[elem][hv] = ko->GetPPACEff(1, Form("%s", cut_name.c_str()), false, elem.c_str());
        }
        delete ko;
    }

    for (const auto &elem : f1Eff) {
        std::cout << elem.first << std::endl;
        for (const auto &hv : hvs) {
            std::cout << hv << " " << f1Eff[elem.first][hv] << std::endl;
        }
    }
}